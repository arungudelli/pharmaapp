<h2 mat-dialog-title>Add Invoice</h2>

<mat-dialog-content class="mat-typography">
  <!-- filter -->
  <!--
    commented code
    <mat-form-field appearance="outline">
      <mat-label>Filter</mat-label>
      <input matInput placeholder="Enter field names to search" #input (keyup)="applyFilter($event)" />
    </mat-form-field>
  -->
  
  <form [formGroup]="editInvoiceAccountsForm">
    <ng-container>
      <div class="leftColumns" formGroupName="distributor">
        <mat-form-field appearance="outline">
          <mat-label>Distributor Name</mat-label>
          <input
            type="text"
            placeholder="Select Distributor"
            matInput
            formControlName="name"
            [matAutocomplete]="autoDistributor"
          />
          <mat-autocomplete
            autoActiveFirstOption
            #autoDistributor="matAutocomplete"
            (optionSelected)="onSelectDistributor($event.option.value)"
          >
            <mat-option
              *ngFor="let option of filteredDistributorOptions | async"
              [value]="option"
            >
              {{ option }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Phone Number</mat-label>
          <input
            type="text"
            placeholder="Phone Number"
            matInput
            formControlName="phoneNumber"
            readonly
          />
        </mat-form-field>
      </div>

      <div class="rightColumns">
        <mat-form-field appearance="outline">
          <mat-label>Bill Number</mat-label>
          <input
            type="text"
            placeholder="Bill Number"
            matInput
            formControlName="billNo"
          />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Bill Date</mat-label>
          <input
            [matDatepicker]="picker"
            placeholder="Bill Date"
            matInput
            formControlName="billDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>
    </ng-container>
  </form>

  <form [formGroup]="editInvoiceForm" autocomplete="off">
    <ng-container formArrayName="invoiceRows">
      <table
        #table
        mat-table
        [dataSource]="staticInvoiceDatasource"
        class="mat-elevation-z8"
      >
        <!--
          commented code 
          matSort
          (matSortChange)="announceSortChange($event)" 
        -->

        <!-- column headers & cell definitions (iterates over columnSchema array) -->
        <ng-container [matColumnDef]="col.key" *ngFor="let col of columnSchema">
          <th mat-header-cell *matHeaderCellDef>
            <!-- 
              commented code
              mat-sort-header
              [sortActionDescription]="col.sortDescription" 
            -->
            {{ col.label }}
          </th>
          <td
            mat-cell
            *matCellDef="let element; let i = index"
            [formGroup]="element"
          >
            <!-- for all inputs except expDate -->
            <mat-form-field
              [appearance]="
                editInvoiceForm.get('invoiceRows')!.value[i].isEditable
                  ? 'fill'
                  : 'outline'
              "
              *ngIf="col.key !== 'expDate'"
            >
              <input
                matInput
                [type]="col.type"
                formControlName="{{ col.key }}"
                [readonly]="
                  editInvoiceForm.get('invoiceRows')!.value[i].isEditable
                "
              />
            </mat-form-field>

            <!-- for expDate input -->
            <mat-form-field
              [appearance]="
                editInvoiceForm.get('invoiceRows')!.value[i].isEditable
                  ? 'fill'
                  : 'outline'
              "
              *ngIf="col.key === 'expDate'"
            >
              <input
                [matDatepicker]="expDatePicker"
                matInput
                [type]="col.type"
                formControlName="{{ col.key }}"
                [readonly]="
                  editInvoiceForm.get('invoiceRows')!.value[i].isEditable
                "
              />
              <!-- {{ editInvoiceForm.get("invoiceRows")!.value[i].expDate }} -->

              <mat-datepicker-toggle
                matSuffix
                [for]="expDatePicker"
              ></mat-datepicker-toggle>
              <mat-datepicker #expDatePicker></mat-datepicker>
            </mat-form-field>
          </td>
        </ng-container>

        <!-- Edit, Save, Discard, Delete button options -->
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef>Action</th>
          <td
            mat-cell
            *matCellDef="let element; let i = index"
            [formGroup]="element"
          >
            <button
              mat-icon-button
              class="material-icons app-toolbar-menu save-button"
              matTooltip="Save Changes"
              *ngIf="!editInvoiceForm.get('invoiceRows')!.value[i].isEditable"
              color="primary"
              (click)="saveForm(editInvoiceForm, i)"
            >
              <mat-icon>check_circle</mat-icon>
            </button>

            <button
              mat-icon-button
              class="material-icons app-toolbar-menu cancel-button"
              matTooltip="Cancel Changes"
              *ngIf="!editInvoiceForm.get('invoiceRows')!.value[i].isEditable"
              color="warn"
              (click)="cancelForm(editInvoiceForm, i)"
            >
              <mat-icon>cancel</mat-icon>
            </button>

            <button
              mat-icon-button
              class="material-icons app-toolbar-menu save-button"
              matTooltip="Edit"
              *ngIf="editInvoiceForm.get('invoiceRows')!.value[i].isEditable"
              color="primary"
              (click)="editForm(editInvoiceForm, i)"
            >
              <mat-icon>edit</mat-icon>
            </button>

            <button
              mat-icon-button
              class="material-icons app-toolbar-menu delete-button"
              matTooltip="Delete"
              *ngIf="editInvoiceForm.get('invoiceRows')!.value[i].isEditable"
              color="warn"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <!-- row headers & definitions -->
        <tr mat-header-row *matHeaderRowDef="staticinvoiceColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: staticinvoiceColumns"></tr>

        <!-- row shown when there is no matching data -->
        <!--
          commented code
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="4">
              No data matching the filter "{{ input.value }}"
            </td>
          </tr>
        -->
      </table>
    </ng-container>
  </form>
  <br />
  <!-- pagination -->
  <mat-paginator
    [pageSizeOptions]="[5, 25, 50, 75]"
    aria-label="select page of ELEMENT_DATA"
  ></mat-paginator>

  <!-- Add New Blank Row -->
  <button mat-raised-button color="primary" (click)="addNewRow()">
    Add Row
  </button>

  <form [formGroup]="editInvoiceAccountsForm">
    <div class="leftColumns">
      <mat-form-field appearance="outline">
        <mat-label>Amount</mat-label>
        <input
          type="text"
          placeholder="amount"
          matInput
          formControlName="amount"
        />
      </mat-form-field>
    </div>

    <div class="rightColumns">
      <mat-form-field appearance="outline">
        <mat-label>Total Discount</mat-label>
        <input
          type="text"
          placeholder="Total Discount"
          matInput
          formControlName="totalDiscount"
        />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Actual Amount</mat-label>
        <input
          type="text"
          placeholder="Actual Amount"
          matInput
          formControlName="actualAmount"
        />
      </mat-form-field>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button mat-dialog-close>Cancel</button>
  <button
    color="primary"
    mat-raised-button
    type="submit"
    [mat-dialog-close]="true"
    (click)="saveInvoice()"
  >
    Save
  </button>
</mat-dialog-actions>
